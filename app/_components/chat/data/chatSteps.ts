import { nanoid } from 'nanoid';
import { ChatStep } from './chatSchemas';
import { ChatValidator } from '../utils/chatValidator';
import { CHAT_STEP_DOMAINS } from './chatDomains';
import {
  formatName,
  formatBirthDate,
  formatGender,
  formatContact,
  formatVisitDateTime,
} from '../utils/chatFormatter';

export const chatSteps: ChatStep[] = [
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[0],
    question: '안녕하세요, 고양이 병원입니다. 환자분 성함이 어떻게 되세요?',
    placeholder: '성함을 입력해주세요.',
    validation: (value: string) => ChatValidator.validateByStep(0, value).isValid,
    errorMessage: '2글자 이상의 한글 또는 영문으로 입력해주세요.',
    messageFormat: formatName,
    inputType: 'text',
  },
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[1],
    question: '네, {name}님 안녕하세요. 어디가 아파서 오셨나요?',
    placeholder: '아픈 곳을 알려주세요.',
    messageFormat: (value: string) => value,
    inputType: 'textarea',
  },
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[2],
    question: '어느 정도로 아프다고 느끼시나요?',
    placeholder: '증상의 강도를 선택해주세요.',
    messageFormat: (value: string) => value,
    inputType: 'select',
    options: [
      { value: '매우 심합니다.', label: '매우 심함' },
      { value: '심합니다.', label: '심함' },
      { value: '보통입니다.', label: '보통' },
      { value: '약간 아픕니다.', label: '약함' },
      { value: '엄청 아프진 않아요.', label: '매우 약함' },
    ],
  },
  {
    id: nanoid(),
    type: 'message',
    domain: CHAT_STEP_DOMAINS[3],
    message: '아이고, 그러셨군요. 네 알겠습니다.',
  },
  {
    id: nanoid(),
    type: 'message',
    domain: CHAT_STEP_DOMAINS[4],
    message: '예약에 앞서 환자분 정보 한 번 확인하겠습니다.',
  },
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[5],
    question: '생년월일이 어떻게 되시나요?',
    placeholder: '생년월일을 선택해주세요.',
    validation: (value: string) => ChatValidator.validateByStep(5, value).isValid,
    errorMessage: '올바른 생년월일을 선택해주세요.',
    messageFormat: formatBirthDate,
    inputType: 'date',
  },
  {
    id: nanoid(),
    type: 'message',
    domain: CHAT_STEP_DOMAINS[6],
    message: '만 31세시군요.',
  },
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[7],
    question: '성별은 어떻게 되세요?',
    placeholder: '성별을 선택해주세요.',
    validation: (value: string) => ChatValidator.validateByStep(7, value).isValid,
    errorMessage: '성별을 선택해주세요.',
    messageFormat: formatGender,
    inputType: 'radio',
    options: [
      { value: '남성', label: '남성' },
      { value: '여성', label: '여성' },
    ],
  },
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[8],
    question: '어떻게 방문하게 되셨나요?',
    placeholder: '방문 경위를 선택해주세요.',
    messageFormat: (value: string) => value,
    inputType: 'radio',
    options: [
      { value: '인터넷 검색으로 알아보고 왔습니다.', label: '인터넷 검색' },
      { value: '지인 소개로 알아보고 왔습니다.', label: '지인 소개' },
      { value: '광고/홍보물로 알아보고 왔습니다.', label: '광고/홍보물' },
    ],
  },
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[9],
    question: '연락처 한 번 적어주시겠어요?',
    placeholder: '연락처를 입력해주세요. (숫자만)',
    validation: (value: string) => ChatValidator.validateByStep(9, value).isValid,
    errorMessage: '올바른 전화번호를 입력해주세요.',
    messageFormat: formatContact,
    inputType: 'number',
  },
  {
    id: nanoid(),
    type: 'message',
    domain: CHAT_STEP_DOMAINS[10],
    message: '네 소중한 정보 감사합니다.',
  },
  {
    id: nanoid(),
    type: 'question',
    domain: CHAT_STEP_DOMAINS[11],
    question: '방문 원하는 날짜와 시간을 알려주시겠어요?',
    placeholder: '방문 날짜와 시간을 선택해주세요. (일요일 제외, 9:00~18:00, 30분 단위)',
    validation: (value: string) => ChatValidator.validateByStep(11, value).isValid,
    errorMessage: '일요일을 제외하고, 9:00~18:00 사이의 30분 단위 시간을 선택해주세요.',
    messageFormat: formatVisitDateTime,
    inputType: 'datetime-local',
  },
  {
    id: nanoid(),
    type: 'message',
    domain: CHAT_STEP_DOMAINS[12],
    message: '네 그럼 그 시간에 뵙겠습니다.',
  },
  {
    id: nanoid(),
    type: 'message',
    domain: CHAT_STEP_DOMAINS[13],
    message: '예약 변동사항이 있다면 연락주세요.',
  },
];
